<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Crate Stacker</title>
  <style>
    :root{color-scheme:dark}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:#0b0c10;color:#e8e8e8}
    .wrap{max-width:980px;margin:0 auto;padding:22px}
    .card{background:#12141a;border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:18px}
    h1{margin:0 0 6px;font-size:28px}
    .sub{opacity:.75;margin:0 0 18px}
    label{display:block;font-size:13px;opacity:.8;margin:14px 0 8px}
    input,textarea,button{width:100%;box-sizing:border-box;border-radius:12px;border:1px solid rgba(255,255,255,.14);
      background:#0f1117;color:#e8e8e8;padding:12px 12px;font-size:14px}
    textarea{min-height:180px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media (max-width:800px){.row{grid-template-columns:1fr}}
    .btn{cursor:pointer;border:none;background:#f4b83f;color:#0b0c10;font-weight:800}
    .btn:active{transform:translateY(1px)}
    .mini{font-size:12px;opacity:.7;margin-top:8px}
    .out{margin-top:14px;padding:14px;border-radius:12px;background:#0f1117;border:1px solid rgba(255,255,255,.1)}
    pre{white-space:pre-wrap;word-wrap:break-word;margin:0}
    .footer{margin-top:18px;opacity:.7;font-size:12px}
    .pill{display:inline-block;padding:4px 10px;border:1px solid rgba(255,255,255,.14);border-radius:999px;margin-right:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Crate Stacker</h1>
      <p class="sub">Turn raw tracklists into clean CJ crates. No fluff. Paste → Parse → Export.</p>

      <div class="row">
        <div>
          <label>Crate name</label>
          <input id="crateName" value="CJ Demo Crate — Day 0" />
        </div>
        <div>
          <label>Notes (optional)</label>
          <input id="notes" placeholder="e.g. Headache run, Sunday arvo test" />
        </div>
      </div>

      <label>Drop a tracklist photo (optional)</label>
      <input id="photo" type="file" accept="image/*" />
      <div class="mini">Auto-OCR in-browser is possible later. For now: photo is stored locally only + you still paste text below (fast + reliable).</div>

      <label>Tracklist (one per line: Artist - Title)</label>
      <textarea id="tracklist" placeholder="Paste here..."></textarea>

      <div class="row">
        <button class="btn" id="btnSeed">Seed with your 10 tracks</button>
        <button class="btn" id="btnMake">Generate Crate JSON</button>
      </div>

      <div class="out" id="out" style="display:none">
        <div style="margin-bottom:10px">
          <span class="pill" id="countPill"></span>
          <button class="btn" id="btnDownload" style="margin-top:10px">Download crate.json</button>
        </div>
        <pre id="json"></pre>
      </div>

      <div class="footer">CrateJuice™ 2025 · PLUR</div>
    </div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);

  const seed = `Headache - Truism 4 Dummies
Headache - Mission Impossible III
Headache - Bucket Listener
Aaron Frazer - If I Got It (Your Love Brought It)
Headache - That Thing with the Rabbit
Headache - The Party that Never Ends
Headache - The Pavement is my Pillow Talk
Parcels - Tieduprightnow
Us3, Rahsaan, Gerard Presencer - Cantaloup (Flip Fantasia)
Poldoore - But I Do`;

  function parseLines(text){
    return text.split(/\r?\n/)
      .map(l => l.trim())
      .filter(Boolean)
      .map((line, idx) => {
        // Accept either "Artist - Title" or "Title - Artist" (we'll assume Artist - Title is intended)
        const parts = line.split(" - ");
        if(parts.length >= 2){
          const artist = parts[0].trim();
          const title = parts.slice(1).join(" - ").trim();
          return { n: idx+1, artist, title, raw: line };
        }
        return { n: idx+1, artist: "", title: "", raw: line, needs_fix: true };
      });
  }

  function makeCrate(){
    const crateName = $("crateName").value.trim() || "Untitled Crate";
    const notes = $("notes").value.trim();
    const tracks = parseLines($("tracklist").value);

    const crate = {
      crate_name: crateName,
      notes,
      created_at: new Date().toISOString(),
      source: "crate-stacker",
      tracks
    };

    const json = JSON.stringify(crate, null, 2);
    $("json").textContent = json;
    $("countPill").textContent = `${tracks.length} tracks`;
    $("out").style.display = "block";

    // download handler
    $("btnDownload").onclick = () => {
      const blob = new Blob([json], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "crate.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    };
  }

  $("btnSeed").addEventListener("click", () => { $("tracklist").value = seed; });
  $("btnMake").addEventListener("click", makeCrate);

  // Photo “auto rule” placeholder (we can wire OCR later)
  $("photo").addEventListener("change", () => {
    // We intentionally do nothing with the image yet — keeps it private/local.
    // Next step: add Tesseract.js OCR + preview-before-add (or instant-add mode).
  });
</script>
</body>
</html>
